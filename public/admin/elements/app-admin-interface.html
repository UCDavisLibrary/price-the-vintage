
<dom-module id="app-admin-interface">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    

    <iron-pages selected="{{selected}}" selected-attribute="active">
      <app-review-marks page="reviewMarks"></app-review-marks>
    </iron-pages>

  </template>
  <script>

(function(){

    var AuthStateEventLoop = {
      req : {
        event : 'get-auth-state'
      },
      resp : {
        event : 'auth-update',
        handle : function(e) {
          if( e.state === 'pending' ) return false;
          return true;
        },
        handler : function(e) {
          this.auth = e;
          this._onAuthUpdate();
        }
      }
    }

    Polymer({
      is: 'app-admin-interface',

      properties : {
        selected : {
          type : Number,
          value : 0
        }
      },

      behaviors : [EventBusBehavior, EventLoopBehavior],

      eventLoops : {
        authState : AuthStateEventLoop
      },

      ready : function() {
        this.eventLoop.authState.req();
      },

      _onAuthUpdate : function() {
        if( this.auth.state === 'notLoggedIn' || !this.auth.user ) {
          window.location = '/';
          return;
        } else if( !this.auth.user.roles ) {
          window.location = '/';
          return;
        } else if( this.auth.user.roles.indexOf('admin') === -1 ) {
          window.location = '/';
          return;
        }
      }

    });

})();
  </script>
</dom-module>
