
<dom-module id="app-page-admin-mark-details">
  <template>
    <style>
      :host {
        display: block;
        height: 232px;
        overflow: auto;
      }
    </style>
    
  </template>
  <script>

    class AppPageAdminMarkDetails extends 
      Mixin(Polymer.Element)
      .with(EventBusMixin, MarksMixin, PagesMixin, ConfigMixin) {

        static get is() {
          return 'app-page-admin-mark-details';
        }

        static get properties() {
          return {
            mark : {
              type : Object,
              observer : '_render',
              value : function() {
                return {};
              }
            }
          }
        }

        constructor() {
          super();
          this.ignore = ['user','created','updated','xy', 'votes'];

          this.labels = {
            wineType : 'Wine Type',
            bottleType : 'Bottle Type',
            price : 'Price per Bottle',
            casePrice : 'Case Price',
            isAnonymous : 'Anonymous User Mark'
          }
        }

        _getMark() {
          if( !this.mark.mark_id ) return;
          return super._getMark(this.mark.mark_id, this.mark.page_id);
        }

        _onMarksUpdate(e) {
          if( e.state !== 'loaded' || e.id !== this.mark.mark_id ) return;
          this._markReady(e);
        }

        _render() {
          if( !this.mark ) return;
          this._getMark();
        }

        _markReady(e) {
          var html = '<table>';
          for( var key in e.data ) {
            if( this.ignore.indexOf(key) > -1 ) continue;
            if( !e.data[key] ) continue;
            html += '<tr><td style="font-weight:bold; text-transform: capitalize">'+this.getLabel(key)+'</td>'+
                    '<td style="color:#757575;padding:5px">';

            if( key === 'created' || key === 'updated' ) {
              html +=  new Date(e.data[key]).toLocaleString();
            } else if( typeof e.data[key] === 'object' ) {
              html += JSON.stringify(e.data[key]);
            } else {
              html += e.data[key];
            }
            html += '</td>';
          }
          this.innerHTML = html+'</table>';
        }

        getLabel(key) {
          return this.labels[key] || key;
        }

      }
    window.customElements.define(AppPageAdminMarkDetails.is, AppPageAdminMarkDetails);
  </script>
</dom-module>
