
<dom-module id="app-user-stats">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        padding: 10px;
        display: block;
      }
      paper-material {
        text-align: left;
        margin: auto;
        display: inline-block;
        background: white;
        padding: 15px;
      }
    </style>
    
    <div style="text-align: center; margin-top: 75px">
      <paper-material>
        <div class="layout">
          <img 
            src="[[photo]]" 
            hidden$="[[!hasPhoto]]" 
            alt="User profile image" 
            style="height: 48px; width: 48px; padding-right: 15px;"/>
          <h1>Welcome [[username]]</h1>
        </div>

        <h2>Here are your stats:</h2>
        <table>
          <tr>
            <td><b>Pending Marks</b></td>
            <td>[[pendingMarks]]</td>
          </tr>
          <tr>
            <td><b>Approved Marks</b></td>
            <td>[[approvedMarks]]</td>
          </tr>
        </table>
      </paper-material>
    </div>
    

  </template>
  <script>

(function() {

    var AuthStateEventLoop = {
      req : {
        event : 'get-auth-state'
      },
      resp : {
        event : 'auth-update',
        handler : function(e) {
          this.auth = e;
          this._renderAuthState();
        }
      }
    }

    Polymer({
      is: 'app-user-stats',

      properties : {
        pendingMarks : {
          type : Number,
          value : 0
        },
        approvedMarks : {
          type : Number,
          value : 0
        }
      },

      behaviors : [EventBusBehavior, EventLoopBehavior],

      eventLoops : {
        authState : AuthStateEventLoop
      },

      ready : function() {
        this.eventLoop.authState.req();
      },

      _renderAuthState : function() {
        this.hasPhoto = false;
        this.isAdmin = false;

        if( this.auth.user ) {

          if( this.auth.user.photoURL ) {
            this.photo = this.auth.user.photoURL;
            this.hasPhoto = true;
          }

          if( this.auth.user.roles  && this.auth.user.roles.indexOf('admin') > -1 ) {
            this.isAdmin = true;
          }

          this.username = this.auth.user.name || this.auth.user.email || 'Anonymous';
        }
      }
    });

})();
  </script>
</dom-module>
