
<dom-module id="app-user-review-voting">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
    <app-price-form-voting id="voting"></app-price-form-voting>

  </template>
  <script>
(function() {

    var GetMarkEventLoop = {
      req : {
        event : 'get-catalog-page-mark',
        payload : function() {
          return {
            markId: this.mark.mark_id,
            pageId: this.mark.page_id,
          }
        }
      },

      resp : {
        event : 'catalog-page-marks-update',
        handle : function(e) {
          if( e.state !== 'loaded' || e.id !== this.mark.mark_id ) return false;
          return true;
        },
        handler : function(e) {
          this._markReady(e);
        },
        debounce : 100
      }
    };

    Polymer({
      is: 'app-user-review-voting',

      properties : {
        mark : {
          type : Object,
          observer : '_render',
          value : function() {
            return {};
          }
        }
      },

      behaviors : [EventBusBehavior, EventLoopBehavior],

      eventLoops : {
        getMark : GetMarkEventLoop
      },

      _render : function() {
        if( !this.mark || !this.eventLoop ) return;
        this.eventLoop.getMark.req();
      },

      _markReady : function(e) {
        this.$.voting.show(e);
      }
    });

})();
  </script>
</dom-module>
