<dom-module id="price-the-vintage">
  <template>
    <style>
      :host {
        display: block;
        height: 100vh;
        position: relative;
      }
    </style>

    <app-location route="{{route}}" use-hash-as-path></app-location>
    <app-route route="{{route}}"
               pattern=":section/:selected"
               data="{{routeInfo}}">
    </app-route> 

    <iron-pages 
      selected="[[selectedSection]]" 
      attr-for-selected="section" 
      selected-attribute="active">

      <app-catalogs-list section="list"></app-catalogs-list>
      <app-pages-list section="catalog"></app-pages-list>
      <wine-page-markup section="page"></wine-page-markup>
    </iron-pages>

  </template>

  <script>
    Polymer({
      is: 'price-the-vintage',

      properties : {
        routeInfo : {
          type : Object,
          value : function(){
            return {};
          },
          observer : '_onRouteChange'
        },
        selectedSection : {
          type : String,
          value : ''
        }
      },

      behaviors : [EventBusBehavior],

      ebBind : {
        'app-state-update' : '_onAppStateUpdate'
      },

      ready : function() {
        this._getAppState();
      },

      _getAppState : function() {
        this.ebEmit('get-app-state', {handler: this._onAppStateUpdate.bind(this)});
      },

      _onAppStateUpdate : function(e) {
        this.selectedSection = e.section;
      },

      _onRouteChange : function() {
        var section = this.routeInfo.section || 'list';
        this.ebEmit('update-app-state', {state: {section: section}});

        switch(section) {
          case 'catalog':
            this.ebEmit('select-catalog', {id: this.routeInfo.selected});
            break;
          case 'page':
            this.ebEmit('select-catalog-page', {id: this.routeInfo.selected});
            break;
        }
      }
      
    });
  </script>

</dom-module>
