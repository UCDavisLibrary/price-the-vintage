
<dom-module id="app-header-list">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }

      #searchContainer {
        margin: 0 10%;
        position: absolute;
        background-color: white;
        color: black;
        padding: 10px;
        z-index: 10;
        top: 65px;
        width: 80%;
      }
      
      paper-input {
        --paper-input-container-color: white;
        --paper-input-container-focus-color: white;
        --paper-input-container-input-color: white;
        color: white;
        --paper-input-container : {
          margin: 0;
        }
      }

      paper-dialog {
        color: black;
      }

      paper-dialog img[icon] {
        background: var(--default-primary-color);
        padding: 10px;
        border-radius: 10px;
        margin-right: 20px;
      }

      #outer-input {
        padding: 0 10px 0 5px;
      }
      #input {
        display: block;
        padding: 5px;
        font-size: 22px;
        width: 100%;
        background: var(--dark-primary-color);
        color: white;
        border: 2px solid white;
        border-radius: 4px;
      }
      #input::-webkit-input-placeholder { /* Chrome/Opera/Safari */
        color: white;
      }
      #input::-moz-placeholder { /* Firefox 19+ */
        color: white;
      }
      #input:-ms-input-placeholder { /* IE 10+ */
        color: white;
      }
      #input:-moz-placeholder { /* Firefox 18- */
        color: white;
      }
    </style>

    <div class="layout center">
      <div hidden$="[[!searchBoxActive]]">
        <iron-icon icon="search"></iron-icon>
      </div>
      <div class="flex">
        
        <h2 hidden$="[[searchBoxActive]]">
          Price the Vintage
        </h2>

        <div id="outer-input" hidden$="[[!searchBoxActive]]">
          <input id="input" on-keyup="_search" placeholder="Search Catalogs" />
        </div>

      </div>
      <div hidden$="[[!searchBoxActive]]">
        <paper-icon-button state="list" icon="close" on-click="_toggleSearch"></paper-icon-button>
      </div>
      <div hidden$="[[searchBoxActive]]">
        <paper-icon-button state="list" icon="search" on-click="_toggleSearch"></paper-icon-button>
      </div>
      <div>
        <paper-icon-button icon="info" on-click="_showHelp"></paper-icon-button>
      </div>
    </div>

    <paper-dialog modal id="popup">
      <div class="layout center">
        <img icon src="/images/wine-icon-32.png" /> 
        <div class="flex">
        <h1>Price the Vintage <paper-icon-button style="float:right;margin-top: -15px;" on-click="_hideHelp" icon="close"></paper-icon-button></h1>
        </div>
      </div>

      <p>Flipping through the pages of the Sherry-Lehmann catalog, produced by the famed New York City wine store, is like stepping back in time. From musings on wines by noted food and wine writer James Beard to charming descriptions of bottles stocked to captivating graphics, this is an immersive history at its finest.</p>
      
      <p>As you flip through the catalogs, you might notice a lot of wine prices. We did too. Our goal is to take those dollar amounts and turn them into a searchable database to allow researchers and wine enthusiasts to chart changing prices and tastes. But to do that, we need your help in transcribing the prices that you see on the pages. So help us ‘Price the Vintage’</p>

      <div style="text-align: center; padding: 25px 0;">
        <h3>Powered By</h3>
        <img src="/images/library.png" style="width:100%; max-width: 350px;" />
      </div>

      <div class="buttons">
        <paper-button on-click="_hideHelp">OK</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>

(function() {

    var SearchCatalogsEventLoop = {
      req : {
        event : 'search-catalogs',
        handle : function() {
          this.eventLoop.appState.req({
            state: {
              searching : true,
              searchText : this.$.input.value
            }
          });
        },
        payload : function() {
          return {
            query : {
              q : this.$.input.value,
              exact : this.appState.searchExact
            }
          }
        },
        debounce : 500
      },

      resp : {
        event : 'search-catalogs-update',
        handle : function(e) {
          return e.state === 'loaded'
        },
        handler : function(e) {
          this.eventLoop.appState.req({
            state: {
              searching : false
            }
          });
        }
      }
    };

    var AppStateEventLoop = {
      req : {
        event : 'update-app-state'
      },
      resp : {
        event : 'app-state-update',
        handler : function(e) {
          this.appState = e;
        }
      }
    }

    Polymer({
      is: 'app-header-list',

      properties : {
        searchBoxActive : {
          type : Boolean,
          value : false
        },
        appState : {
          type : Object,
          value : function() {
            return {}
          }
        }
      },

      eventLoops : {
        searchCatalogs : SearchCatalogsEventLoop,
        appState : AppStateEventLoop
      },

      behaviors : [EventBusBehavior, EventLoopBehavior],

      attached : function() {
        if( !window.localStorage.getItem('first-viewing') ) {
          this.$.popup.open();
          window.localStorage.setItem('first-viewing', 'true');
        } 
      },

      _toggleSearch : function(){
        this.searchBoxActive = !this.searchBoxActive;

        if( this.searchBoxActive ) {
          this.$.input.focus();
        }

        this.eventLoop.appState.req({
          state: {
            searchBoxActive : this.searchBoxActive
          }
        });
      },

      _search : function() {
        this.eventLoop.searchCatalogs.req();
      },

      _showHelp : function() {
        this.$.popup.open();
      },

      _hideHelp : function() {
        this.$.popup.close();
      }
    });
})();
  </script>
</dom-module>
