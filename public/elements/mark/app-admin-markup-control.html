
<dom-module id="app-admin-markup-control">
  <template>
    <style>
      :host {
        display: block;
        padding-top: 15px;
      }
      .btn {
        cursor: pointer;
        display: inline-block;
        background-color: white;
        border: 2px solid rgba(0,0,0,0.2);
        border-radius: 4px;
        width: 30px;
        height: 30px;
        -webkit-background-clip: padding-box;
        background-clip: padding-box;
      }
      .btn iron-icon {
        padding: 4px;
        width: 22px;
        height: 22px;
        color: #333;
      }
    </style>
    
    <div hidden$="[[!show]]">
      <div>
        <a class="btn" on-click="_setDone">
          <iron-icon icon="done-all"></iron-icon>
        </a>
      </div>
      <div style="margin-top: 5px">
        <a class="btn" on-click="_setIgnore">
          <iron-icon icon="block"></iron-icon>
        </a>
      </div>
    </div>

    <paper-dialog modal id="donePopup">
      <div class="layout center">
        <h1>Page Marks Completed</h1>
      </div>

      <p>Have all entries for this page been marked and approved?</p>

      <div class="buttons">
        <paper-button on-click="_hideDone">Cancel</paper-button>
        <paper-button on-click="_hideDone">Completed</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog modal id="ignorePopup">
      <div class="layout center">
        <h1>Ignore Page</h1>
      </div>

      <p>This page contains no entries to be marked.</p>

      <div class="buttons">
        <paper-button on-click="_hideIgnore">Cancel</paper-button>
        <paper-button on-click="_hideIgnore">Ignore Page</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>

(function(){
    L.Control.AdminControl = L.Control.extend({
        onAdd: function(map) {
            var control = L.DomUtil.create('app-admin-markup-control');
            return control;
        },

        onRemove: function(map) {
            // Nothing to do here
        }
    });

    L.control.adminControl = function(opts) {
        return new L.Control.AdminControl(opts);
    }

    var AuthStateEventLoop = {
      req : {event: 'get-auth-state'},
      resp : {
        event : 'auth-update',
        handler : function(e) {
          this.authState = e;

          if( e.state === 'loggedIn' && e.user.isAdmin ) {
            this.show = true;
          } else {
            this.show = false;
          }

        }
      }
    };


    Polymer({
      is: 'app-admin-markup-control',

      properties : {
        show : {
          type : Boolean,
          value : false
        }
      },

      behaviors : [EventBusBehavior, EventLoopBehavior],

      eventLoops : {
        authState : AuthStateEventLoop
      },

      ready : function() {
        this.$.donePopup.parentElement.removeChild(this.$.donePopup);
        document.body.appendChild(this.$.donePopup);
        
        this.$.ignorePopup.parentElement.removeChild(this.$.ignorePopup);
        document.body.appendChild(this.$.ignorePopup);

        this.eventLoop.authState.req();
      },

      _setDone : function() {
        this.$.donePopup.open();
      },

      _hideDone : function() {
        this.$.donePopup.close();
      },

      _setIgnore : function() {
        this.$.ignorePopup.open();
      },

      _hideIgnore : function() {
        this.$.ignorePopup.close();
      }
    });
})();
  </script>
</dom-module>
